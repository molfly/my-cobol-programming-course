# Первый взгляд на структурированный COBOL

COBOL - это структурированный язык. Вы уже видели некоторые правила для макета, но структура идет глубже, чем просто физический макет. Структурирование относится к DATA и PROCEDURE DIVISION программы COBOL.

## Новая оболочка COBOL
Отныне все программы будут иметь какие-то данные в них, поэтому неплохо бы изменить cobshl01.cbl, созданный в первый день, «Ваша первая программа на COBOL». cobshl02.cbl, теперь включает WORKING-STORAGE.

## Paragraph Names
Поскольку названия абзацев используются только в качестве закладок, в эту программу можно добавить больше имен абзацев. Помните, что вы можете назначить свои собственные названия абзацев. Правила именования абзацев аналогичны правилам именования переменных:

* Название абзаца может содержать 30 символов. На самом деле имя абзаца может быть длиннее 30 символов, но компилятор предупредит вас, что будет использовать только первые 30 символов имени. Остальные символы могут быть включены в имя, но компилятор их игнорирует.
* Символы могут быть от A до Z, от 0 до 9 и дефис (-). Некоторые компиляторы также допускают использование строчных букв от a до z.
* Название абзаца не должно начинаться с дефиса.
* Имена абзацев должны начинаться в области A, столбцы с 8 по 11, и должны заканчиваться точкой.

Делать - не делать: DO Используйте названия заглавных букв в верхнем регистре, если вы хотите, чтобы ваш код был переносимым.
НЕ используйте строчные имена абзацев. Даже самые простые программы на языке COBOL имеют тенденцию выживать и расти. Однажды вы можете портировать программу на новый компьютер, и вы будете проклинать себя за использование строчных букв.

## Что такое STOP RUN?
В любом языке программирования определенные слова имеют особое значение в языке. В COBOL, DISPLAY «Hello» заставляет слово Hello отображаться на экране. DISPLAY имеет особое значение в языке COBOL. Это означает «поставить следующую вещь на экране».

Новый термин: зарезервированные слова зарезервированы в языке, чтобы иметь особое значение, и программист не может использовать эти слова для каких-либо других целей.

Слова `DATA` и `DIVISION`, появляющиеся вместе, означают, что раздел программы, в котором определены данные, начинается. `DATA`, `DIVISION` и `DISPLAY` являются зарезервированными словами. Поэтому, если вы создаете программу, которая отображает что-то, было бы неправильно назвать программу `DISPLAY` следующим образом:
```
PROGRAM-ID. DISPLAY.
```
Компилятор, вероятно, будет жаловаться на неверное имя программы, потому что `DISPLAY` зарезервирован для специального значения в COBOL. Вы уже выучили несколько зарезервированных слов: `COMPUTE`, `ACCEPT`, `ADD`, `PROCEDURE`, `DIVISION` и другие.

Делать - не делать: DO называть программы, переменные и абзацы описательными именами, которые делают их использование очевидным.
НЕ называйте программы, переменные или абзацы зарезервированными словами.

## Что такое глагол PERFORM?
Программа, которая выполняется от начала до конца, а затем останавливается, может быть полезна для чего-то, но она не сделает намного больше, чем уже рассмотренные примеры. Предположим, у вас было одно действие, которое вы выполнили несколько раз в программе. При выполнении сверху вниз вам придется кодировать одну и ту же логику снова и снова.
Глагол PERFORM позволяет избежать этой проблемы кодирования повторяющихся действий. Чтобы проиллюстрировать эффект PERFORM, используется другая версия программы «Hello world». PERFORM - это своего рода «прыжок» с «отскоком назад».

АНАЛИЗ hello04.cbl: В строке 001200 PERFORM SAY-HELLO указывает следующее: 
1. Найдите абзац с именем SAY-HELLO.
2. Перейти к этому абзацу и начать выполнение там.
3. Когда этот абзац заканчивается, вернитесь к концу этого предложения (PERFORM SAY-HELLO).

### PERFORM
Программа выполняет абзац из `PERFORM` даже если он находится после `STOP RUN.`. То есть, если нужно вызвать конкретный абзац несколько раз, нужно держать его после `STOP RUN.`.

## Когда использовать PERFORM
PERFORM имеет несколько применений в COBOL. Во-первых, он используется для выделения повторяющегося действия, которое выполняется в программе в нескольких местах или несколько раз, чтобы предотвратить повторное написание одного и того же кода. Создает два преимущества: он не только сокращает количество набираемых текстов, но и уменьшает количество потенциальных ошибок. Меньше печатать означает меньше возможностей для его неправильного копирования.

Представьте, что вы вводите следующую формулу розничной прибыли пять или шесть раз в разных местах программы, и вы начинаете понимать смысл помещать ее в абзац под названием `COMPUTE-RETAIL-PROFIT` и использовать глагол PERFORM каждый раз, когда вы этого хотите:
```
COMPUTE MARGIN-PERCENT =    
    ( (GOODS-PRICE - GOODS-COST) /             
             GOODS-PRICE ) * 100 .
```

Второе использование PERFORM может быть не столь очевидным, потому что программы, используемые до сих пор в этой книге, были относительно небольшими. PERFORM служит для разбиения программы на более мелкие, более управляемые части. Если вы измените комиссию за продажу с 10 до 11 процентов, гораздо проще найти длинную программу, которая ищет абзац с именем `CALCULATE-COMMISSION`, чем пролистывать длинный список кода, не разбитого на абзацы. Обычно программы выполняют более одной основной задачи. В системе начисления заработной платы может быть программа, используемая как для расчета общей суммы заработной платы, так и для печати чеков после ввода часов для каждого сотрудника в компьютер.

Программа, которая выполняет эти действия, может иметь одну область программы для выполнения вычислений, в то время как дальше в программе другая область кода имеет дело с операцией печати. Над этими двумя областями находится основная логика программы, которая выполняет обе части программы:
```
MAIN-LOGIC.    
    PERFORM CALC-PAYROLL-TOTALS.    
    PERFORM PRINT-PAYROLL-CHECKS.
```

Третья причина использования `PERFORM` состоит в том, что программу легче читать и понимать, если абзацы названы разумно. В следующем фрагменте кода довольно легко понять, что делает абзац `PAY-THE-SALESPERSON`, даже если весь абзац состоит из PERFORMs:
```
PAY-THE-SALESPERSON    
    PERFORM GET-SALES-TOTAL.    
    PERFORM CALCULATE-COMMISSION.    
    PERFORM PRINT-THE-CHECK.
```

Четвертой причиной использования `PERFORM` является сохранение памяти. Посмотрите на формулу розничной прибыли и представьте, что фрагмент кода повторяется пять или шесть раз в одной программе. Каждый раз, когда формула появляется в программе, она занимает несколько байтов памяти. Кодирование его один раз в одном абзаце и выполнение этого абзаца пять или шесть раз занимает гораздо меньше памяти.
Давайте подробнее рассмотрим первую причину `PERFORM`, которая заключается в обработке повторяющегося кода. «Леди из Эйгера» похож на `jack03.cbl`, использованный во второй день «Использование переменных и констант». В строке `001800 THE-NUMBER` инициализируется равным 0, а затем (вместо перемещения 1 в `THE-NUMBER` в строке `002300`) 1 добавляется в `THE-NUMBER`.